var keys=[],count=0,formData=new FormData,oldValue=0,oldInterval;function getResoulution(a,b,c,d){var f=window.URL||window.webkitURL,g=new Image;g.onload=function(){return ajaxSendChecksum(b,sha3_512(a.result),this.width+"x"+this.height,b.size,c,d)},g.src=f.createObjectURL(b)}function checkChecksum(a,b,c){oldValue="0";var d=new FileReader;d.onload=function(){return getResoulution(this,a,b,c)},d.readAsArrayBuffer(a)}function ajaxSendChecksum(a,b,c,d,f,g){$.ajax({url:"/checksum?checksum="+b+"&resolution="+c+"&size="+d,type:"POST",success(h){return"none"===h||f||(window.location.href=site+"image/"+h),f?("none"===h?formData.append("files",a):keys[count++]=h,oldValue++,"are1"===f&&(oldInterval=setInterval(function(){oldValue===g&&(ajaxSends(formData,keys),formData=new FormData,count=0,keys=[],oldValue=0,clearInterval(oldInterval))},50))):(formData.append("file",a),ajaxSend(formData),formData=new FormData),h}})}