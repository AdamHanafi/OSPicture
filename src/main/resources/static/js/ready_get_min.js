var resolution,isResolution,typeAnimation,notifDownload=0,rotateDeg=0,mainReady=$(".main"),transitSetting="opacity .05s, transform .2s ease-in, box-shadow .2s ease-in",body=$("body"),footer=$(".footer"),isProcessing=!1,resolutionElem=$("#resolution"),downloadPictureElem=$("#download-picture"),fileElem=$(".file"),arrowLeftElem=$("#arrow-left"),arrowRightElem=$("#arrow-right"),fileInfoElem=$("#file-info"),sizeElem=$("#size"),formatElem=$("#format"),infoElem=$(".info"),directLinkElem=$("#direct-link"),htmlLinkElem=$("#html-link"),bbcodeLinkElem=$("#bbcode-link"),px200ELem=$("#px200"),px500Elem=$("#px500"),notification=$(".notification");notification.css("display","block");function settingPicture(){mainReady.css("top","0"),mainReady.css("bottom","0"),2>$(".main").length?(mainReady.css("left","0"),mainReady.css("right","0")):"left"===typeAnimation?(mainReady.css("left","-100%"),mainReady.css("right","100%")):(mainReady.css("left","100%"),mainReady.css("right","-100%")),480<screen.width&&footer.css("bottom","-44px"),footer.css("background-color","rgba(0,0,0,0.7)"),body.css("background-color","black"),body.css("transition","background-color .2s")}function setPicture(a,b){picture.css("max-width",a),picture.css("max-height",b)}function calculateView(a,b){if(isResolution=resolution[a]>resolution[b],window.innerWidth<=resolution[a]&&window.innerHeight<=resolution[b]){var c=window.innerWidth>window.innerHeight,d=(resolution[a]/resolution[b]+"").substring(0,3),e=d===(window.innerWidth/window.innerHeight+"").substring(0,3);if(isResolution){if(c&&((screen.width/screen.height+"").substring(0,3)===d&&211>=screen.width-window.innerWidth&&211>=screen.height-window.innerHeight||e))return settingPicture(),resolution[0]>resolution[1]&&0===a?setPicture("100%","inherit"):setPicture("inherit",main.width()+(main.width()===picture.css("max-height")?0:"0px"===main.css("left")?0:50)),!0;}else if(!c&&e)return settingPicture(),0===a?setPicture("inherit",main.height()+(480>screen.width?395:main.height()===picture.css("max-width")?0:"0px"===main.css("left")?0:140)):setPicture("calc","inherit"),!0}return!1}function setMainReady(a,b){a.css("left","calc("+(b?"-":"+")+"100% + 25px)"),a.css("right","calc("+(b?"+":"-")+"100% + 25px)")}function setMainReadyPx(a){body.css("background-color","25px"===a?"#34495E":"black"),mainReady.css("left",a),mainReady.css("right",a)}function addListenerDownload(a,b){var c="picture"===b;c&&(resolution=resolutionElem.text().split("x"),setTimeout(function(){picture?0==notifDownload&&(mainReady.append($("<div/>",{class:"flowspinner"}),$("<span/>",{class:"download-info"}).text("Downloading")),notifDownload=1):1<$(".main").length&&($(".picture").first().css("filter","brightness(40%)"),$(".main").first().append($("<div/>",{class:"flowspinner"})),notifDownload=1)},400));var d=$("<img />",{"class":b,alt:"Image"}).attr("src",(c?"/img/":"/img_min/")+a.data("key")+"."+a.data("format")).on("load",function(){this.complete&&"undefined"!=typeof this.naturalWidth&&0!==this.naturalWidth?(c&&(notifDownload=1,$(".flowspinner").length&&($(".flowspinner").remove(),$(".download-info").remove())),a.append(d[0]),c&&(picture=$(".picture").last(),calculateView(0,1),1<$(".main").length&&"0px"!==mainReady.css("top")&&("right"===typeAnimation?setMainReady(mainReady,!1):setMainReady(mainReady,!0)),"0px"!==mainReady.css("top")&&(footer.css("bottom",$(".arrow-box").length?"-44px":"0px"),footer.css("background-color","transparent"))),setTimeout(function(){2>$(".main").length&&(c?d[0].style.transition=transitSetting+",  max-width .2s ease-in, max-height .2s ease-in":d[0].style.transition="filter .2s ease-in, "+transitSetting),d[0].style.transform="rotateX(0deg)",d[0].style.boxShadow="none",d[0].style.opacity="1",c&&(setTimeout(function(){mainReady.css("transition","top .2s, bottom .2s, left .2s, right .2s"),d[0].style.transition=transitSetting+",  max-width .2s ease-in, max-height .2s ease-in";var e=$(".main");1<e.length?("left"===typeAnimation?setMainReady($(e[0]),!1):setMainReady($(e[0]),!0),"0px"===mainReady.css("top")?setMainReadyPx("0px"):setMainReadyPx("25px"),setTimeout(function(){$(e[0]).remove(),isProcessing=!1,main=$(".main"),rotateDeg=0},200)):isProcessing=!1},40),$(window).resize(function(){calcViewRotateDeg()}))},20)):a.append($("<span />").text("Broken image"))})}setTimeout(function(){if($(".arrow-box").length&&(480>screen.width?$(".footer").css("display","none"):$(".footer").css("bottom","-44px")),downloadPictureElem.length)addListenerDownload(mainReady,"picture");else for(var a=0;a<fileElem.length;a++)addListenerDownload($(fileElem[a]),"image-folder")},20),""!==mainReady.data("left")&&(document.onkeydown=function(a){a=a||window.event,37===a.keyCode?arrowLeftElem.click():39===a.keyCode&&arrowRightElem.click()});function settingNewPicture(a){var b=$("<div>",{"class":"main"});mainReady.after(b),mainReady=$(".main").last(),window.history.pushState("html","OSPicture - Hosting the images","/image/"+a.key),mainReady.data("key",a.key),mainReady.data("format",a.format),infoElem.css("bottom","-44px"),setTimeout(function(){resolutionElem.text(a.resolution),fileInfoElem.text(a.name),fileInfoElem.click(function(){actionCopyToClipboard(a.name)}),sizeElem.text(a.size),formatElem.text("true"===a.isOctetStream?"octet-stream":a.format),addListenerDownload(mainReady,"picture"),setTimeout(function(){infoElem.css("bottom","10px")},20)},200),downloadPictureElem.attr("href","/img/"+a.key),downloadPictureElem.attr("download",a.name+("true"===a.isOctetStream?"":".")+("true"===a.isOctetStream?"":a.format)),directLinkElem.click(function(){actionCopyToClipboard(site+"img/"+a.key+"."+a.format)}),htmlLinkElem.click(function(){actionCopyToClipboard("<a href=\""+window.location.href+"\"><img src=\""+site+"img/"+a.key+"."+a.format+"\" alt=\"Image from OSPicture\"></a>")}),bbcodeLinkElem.click(function(){actionCopyToClipboard("[url="+window.location.href+"][img]"+site+"img/"+a.key+"."+a.format+"[/img][/url]")}),px200ELem.attr("href","/"+a.px200Path),px500Elem.attr("href","/"+a.px500Path),mainReady.data("left",a.folderLeft),mainReady.data("right",a.folderRight)}function actionDoLeft(a){typeAnimation="left",settingNewPicture(a)}function actionDoRight(a){typeAnimation="right",settingNewPicture(a)}